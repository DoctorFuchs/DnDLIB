{% extends "base.html" %}
{% import "/api/models.html" as model %}
{% set head = ["name", "full_name"] %}
{% set information_tags = ["weight", "cost", "quantity", "abbreviation"] %}
{% set tags = ["equipment_category", "gear_category"] %}
{% set bottom = ["class", "subclasses", "race"]%}
{% set descriptions = ["desc"] %}
{% set blocked = ["index", "url"]+ head + information_tags + descriptions + bottom + tags%}


{% macro render_single(key, value, headings=True) %}
<section id="{{key}}">
    {% if value is mapping %}
        {{ model.Object(value) }}

    {% elif value is string %}
        {% if value.startswith("/api") %}
            {{model.APIReference({
                "name":key,
                "index":key,
                "url":value
            })}}

        {% else %}
            {% if headings == True %} <b>{{model.String(key)}}: </b> {% endif %}
            {{model.String(value)}}

        {% endif %}

    {% elif value is number %}
        {% if headings == True %} <b>{{model.String(key)}}: </b> {% endif %}
        {{model.Number(value)}}
        {% if key == "weight" %}lbs{% endif %}

    {% elif value is boolean %}
        {% if headings == True %} <b>{{model.String(key)}}</b> {% endif %}
         {{model.Boolean(value)}}

    {% elif value is mapping %}
        {{model.Object(value)}}

    {% elif value is iterable %}
        {% if value|length != 0 %}
            {% if headings == True %} <h2>{{model.String(key)}}</h2> {% endif %}
            {{model.List(value)}}
        {% endif %}

    {% else %}
        {{model.String(value)}}

    {% endif %}

</section>
{% endmacro %}

{% macro render_table(json) %}
{% if json|length != 0%}
    <table class="w3-table w3-striped">
        <tr>
        {% for key in json[0].keys() %}
            {% if key in blocked%}
            {% else %}
                <th>{{model.String(key)}}</th>
            {% endif %}
        {% endfor %}
        </tr>
        {% for row in json %}
            <tr>
                {% for key, value in row.items() %}
                    {% if key in blocked%}
                    {% else %}
                        <td>{{render_single("", value, headings=False)}}</td>
                    {% endif %}
                {% endfor %}
            </tr>
        {% endfor %}
    </table>
{% endif %}
{% endmacro %}

{% macro main_render(json) %}
    <div class="w3-content w3-container page">
        {% if json is mapping %}
            {% set title = json.get("full_name", json.get("name", base_node))%}
            <a class="w3-right w3-hover-text-green bookmark-button">
                <h1><i class="fa fa-thumb-tack" name="{{title}}"></i></h1>
            </a>
            <h1>{{title}}</h1>

            <div class="w3-half">
                {% for key in information_tags %}
                    {% if not key in json %}
                    {% else %}
                        {{render_single(key, json.get(key))}}
                    {% endif %}
                {% endfor %}
            </div>
            <div class="w3-container w3-rest">
                {% for key in descriptions %}
                    {% if not key in json %}
                    {% else %}
                        {{render_single(key, json.get(key), false)}}
                    {% endif %}
                {% endfor %}
            </div>
            {% for key, value in json.items() %}
                {% if key in blocked %}
                {% else %}
                    {{render_single(key, value)}}
                {% endif %}
            {% endfor %}

            {% for key in bottom %}
                {% if not key in json %}
                {% else %}
                    {{render_single(key, json.get(key))}}
                {% endif %}
            {% endfor %}

            {% for key in tags %}
                {% if not key in json %}
                {% else %}
                    <div class="w3-tag" style="background-color:transparent;">{{render_single(key, json.get(key))}}</div>
                {% endif %}
            {% endfor %}


        {% elif json is iterable %}
            {{render_table(json) }}

        {% endif %}
    </div>
{% endmacro %}

{% block content %}
{{main_render(api_resp)}}
{{api_resp}}
{% endblock%}
