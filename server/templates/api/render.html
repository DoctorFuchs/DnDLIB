{% extends "base.html" %}
{% import "models.html" as model %}
{% set head = ["name", "full_name"] %}
{% set blocked = ["index", "url"]%}
{% set bottom = ["class", "subclasses"]%}

{% macro render_single(key, value, headings=True) %}
<section id="{{key}}">
    {% if value is mapping %}
        {{ model.Object(value) }}

    {% elif value is string %}
        {% if value.startswith("/api") %}
            {{model.APIReference({
                "name":key,
                "index":key,
                "url":value
            })}}

        {% else %}
            {{model.String(value)}}

        {% endif %}

    {% elif value is number %}
        <b>{{model.String(key)}}</b> {{model.Number(value)}}

    {% elif value is boolean %}
        <b>{{model.String(key)}}</b> {{model.Boolean(value)}}

    {% elif value is mapping %}
        {{model.Object(value)}}

    {% elif value is iterable %}
        {% if value|length != 0 %}
            {% if headings == True %} <h2>{{model.String(key)}}</h2> {% endif %}
            {{model.List(value)}}
        {% endif %}

    {% else %}
        {{model.String(value)}}

    {% endif %}

</section>
{% endmacro %}

{% macro render_table(json) %}
{% if json|length != 0%}
    <table class="w3-table w3-striped">
        <tr>
        {% for key in json[0].keys() %}
            {% if key in blocked or key in bottom or key in head%}
            {% else %}
                <th>{{model.String(key)}}</th>
            {% endif %}
        {% endfor %}
        </tr>
        {% for row in json %}
            <tr>
                {% for key, value in row.items() %}
                    {% if key in blocked or key in bottom or key in head%}
                    {% else %}
                        <td>{{render_single("", value, headings=False)}}</td>
                    {% endif %}
                {% endfor %}
            </tr>
        {% endfor %}
    </table>
{% endif %}
{% endmacro %}

{% macro main_render(json) %}
    <div class="page w3-content w3-container">
        {% if json is mapping %}
            {% if "full_name" in json %}
                <h1>{{model.String(json.get("full_name"))}}</h1>
            {% else %}
                <h1>{{model.String(json.get("name", base_node))}}</h1>
            {% endif %}

            {% for key, value in json.items() %}
                {% if key in blocked or key in bottom or key in head%}
                {% else %}
                    {{render_single(key, value)}}
                {% endif %}
            {% endfor %}

            {% for key in bottom %}
                {% if not key in json %}
                {% else %}
                    {{render_single(key, json.get(key))}}
                {% endif %}
            {% endfor %}

        {% elif json is iterable %}
            {{render_table(json) }}

        {% endif %}
    </div>
{% endmacro %}

{% block content %}
{{main_render(api_resp)}}
{% endblock%}
